<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Test - All-in-One System Tools</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .test-pass {
            background-color: #d1e7dd;
            border: 1px solid #badbcc;
            color: #0f5132;
        }
        .test-fail {
            background-color: #f8d7da;
            border: 1px solid #f5c2c7;
            color: #842029;
        }
        .test-pending {
            background-color: #fff3cd;
            border: 1px solid #ffecb5;
            color: #664d03;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-flask me-2"></i>All-in-One System Tools - Integration Test</h3>
                    </div>
                    <div class="card-body">
                        <div id="test-results">
                            <div class="test-result test-pending">
                                <i class="fas fa-clock me-2"></i>Initializing tests...
                            </div>
                        </div>
                        <div class="mt-4">
                            <button class="btn btn-primary" onclick="runTests()">
                                <i class="fas fa-play me-1"></i>Run Integration Tests
                            </button>
                            <button class="btn btn-success" onclick="openMainApp()" style="margin-left: 10px;">
                                <i class="fas fa-external-link-alt me-1"></i>Open Main Application
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let testResults = [];

        function addTestResult(name, passed, message) {
            testResults.push({ name, passed, message });
            updateTestDisplay();
        }

        function updateTestDisplay() {
            const container = document.getElementById('test-results');
            container.innerHTML = '';
            
            testResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result ${result.passed ? 'test-pass' : 'test-fail'}`;
                div.innerHTML = `
                    <i class="fas fa-${result.passed ? 'check-circle' : 'times-circle'} me-2"></i>
                    <strong>${result.name}</strong>: ${result.message}
                `;
                container.appendChild(div);
            });
        }

        async function testApiEndpoint(name, endpoint) {
            try {
                const response = await fetch(endpoint);
                const data = await response.json();
                
                if (response.ok) {
                    addTestResult(name, true, `API endpoint responding correctly (${response.status})`);
                    return data;
                } else {
                    addTestResult(name, false, `API endpoint returned error ${response.status}`);
                    return null;
                }
            } catch (error) {
                addTestResult(name, false, `API endpoint failed: ${error.message}`);
                return null;
            }
        }

        function testFileLoad(name, url) {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = () => {
                    addTestResult(name, true, 'JavaScript file loaded successfully');
                    resolve(true);
                };
                script.onerror = () => {
                    addTestResult(name, false, 'JavaScript file failed to load');
                    resolve(false);
                };
                document.head.appendChild(script);
            });
        }

        function testCssLoad(name, url) {
            return new Promise((resolve) => {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = url;
                link.onload = () => {
                    addTestResult(name, true, 'CSS file loaded successfully');
                    resolve(true);
                };
                link.onerror = () => {
                    addTestResult(name, false, 'CSS file failed to load');
                    resolve(false);
                };
                document.head.appendChild(link);
            });
        }

        async function runTests() {
            testResults = [];
            
            // Test main files
            await testFileLoad('Main JavaScript (app.js)', '/app.js');
            await testCssLoad('Main CSS (main.css)', '/main.css');
            
            // Test static files
            await testFileLoad('Dashboard JS', '/static/js/dashboard.js');
            await testFileLoad('Battery JS', '/static/js/battery.js');
            await testFileLoad('Diagnostics JS', '/static/js/diagnostics.js');
            await testFileLoad('Monitoring JS', '/static/js/monitoring.js');
            await testFileLoad('Packages JS', '/static/js/packages.js');
            
            await testCssLoad('Dashboard CSS', '/static/css/dashboard.css');
            await testCssLoad('Battery CSS', '/static/css/battery.css');
            
            // Test API endpoints
            await testApiEndpoint('Battery API', '/api/battery/info');
            await testApiEndpoint('Monitoring API', '/api/monitoring/metrics');
            await testApiEndpoint('Package Count API', '/api/packages/count');
            
            // Test main page
            try {
                const response = await fetch('/');
                if (response.ok) {
                    addTestResult('Main Page', true, 'Main application page is accessible');
                } else {
                    addTestResult('Main Page', false, `Main page returned error ${response.status}`);
                }
            } catch (error) {
                addTestResult('Main Page', false, `Main page failed: ${error.message}`);
            }
            
            // Summary
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${passed === total ? 'test-pass' : 'test-fail'}`;
            summaryDiv.innerHTML = `
                <i class="fas fa-clipboard-check me-2"></i>
                <strong>Test Summary</strong>: ${passed}/${total} tests passed
            `;
            document.getElementById('test-results').appendChild(summaryDiv);
        }

        function openMainApp() {
            window.open('/', '_blank');
        }

        // Run tests on page load
        window.onload = () => {
            setTimeout(runTests, 1000);
        };
    </script>
</body>
</html>